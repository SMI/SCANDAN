# Generated by Neurodocker and Reproenv.
# Modified by rkm

FROM debian:bullseye-slim

ENV \
    OS="Linux" \
    FREESURFER_VERSION="7.3.0" \
    FS_OVERRIDE="0" \
    FSF_OUTPUT_FORMAT="nii.gz# mni env requirements" \
    FIX_VERTEX_AREA=""
ENV FREESURFER_HOME="/opt/freesurfer-${FREESURFER_VERSION}"
ENV MNI_DIR="${FREESURFER_HOME}/mni"
ENV \
    PATH="${FREESURFER_HOME}/bin:${FREESURFER_HOME}/fsfast/bin:${FREESURFER_HOME}/tktools:${FREESURFER_HOME}/mni/bin:$PATH" \
    FREESURFER="${FREESURFER_HOME}" \
    SUBJECTS_DIR="${FREESURFER_HOME}/subjects" \
    LOCAL_DIR="${FREESURFER_HOME}/local" \
    FSFAST_HOME="${FREESURFER_HOME}/fsfast" \
    FMRI_ANALYSIS_DIR="${FREESURFER_HOME}/fsfast" \
    FUNCTIONALS_DIR="${FREESURFER_HOME}/sessions" \
    MINC_BIN_DIR="${MNI_DIR}/bin" \
    MINC_LIB_DIR="${MNI_DIR}/lib" \
    MNI_DATAPATH="${MNI_DIR}/data" \
    MNI_PERL5LIB="${MNI_DIR}/share/perl5" \
    PERL5LIB="${MNI_DIR}/share/perl5"

RUN : \
    && apt-get update -qq \
    && DEBIAN_FRONTEND=noninteractive apt-get install \
           -qq -y --no-install-recommends \
           bc \
           ca-certificates \
           curl \
           libgomp1 \
           libxmu6 \
           libxt6 \
           perl \
           tcsh \
    && apt-get clean \
    && rm -rf /var/lib/apt/lists/* \
    && :

RUN : \
    && set -eu \
    && mkdir -p /opt/freesurfer-7.3.0 \
    && cd /tmp \
    && curl -sfL https://surfer.nmr.mgh.harvard.edu/pub/dist/freesurfer/7.3.0/freesurfer-linux-centos7_x86_64-7.3.0.tar.gz \
         | tar -xz -C /opt/freesurfer-7.3.0 --owner root --group root --no-same-owner --strip-components 1 \
             --exclude='average/mult-comp-cor' \
             --exclude='lib/cuda' \
             --exclude='lib/qt' \
             --exclude='subjects/V1_average' \
             --exclude='subjects/bert' \
             --exclude='subjects/cvs_avg35' \
             --exclude='subjects/cvs_avg35_inMNI152' \
             --exclude='subjects/fsaverage3' \
             --exclude='subjects/fsaverage4' \
             --exclude='subjects/fsaverage5' \
             --exclude='subjects/fsaverage6' \
             --exclude='subjects/fsaverage_sym' \
             --exclude='trctrain' \
    && :

